---
import Layout from "@/layouts/PanelViewLayout.astro";
import BackButton from "@/components/custom-ui/BackButton";
import { MenuItemProps } from "@/components/menu/MenuItem";
import IssueCard from "@/components/issue/UpdatableIssueContentPanel";
import VotingSection from "@/components/issue/IssuePrioritificationPanel.astro";
import ChatPanel from "@/components/chat";
import IssueDetails from "@/components/issue/UpdatableIssueDetailsPanel";

import NotificationBanner from "@/components/NotificationBanner";

const additional: MenuItemProps[] = [
  {
    icon: "cascading-work",
    label: "Cascading Work",
    href: "/maintainer/work",
  },
  {
    icon: "issue",
    label: "Issues List/Roadmap",
    href: "/data/project",
    active: true,
  },
  {
    icon: "issue",
    label: "Issue",
    href: "/data/issue",
    active: true,
  },
];

// Project ID + Not Yet Created + Fork Project means issue is created for the
// original project forked by project ID.
const projectId = Astro.url.searchParams.get("projectId") || undefined;
const notYetCreated = Astro.url.searchParams.get("notYetCreated") || false;
const forkProject = Astro.url.searchParams.get("forkProject") || undefined;

const isForOriginal = projectId && notYetCreated && forkProject;

const backHref = isForOriginal
  ? "/data/project/post?projectId=1&forkProjectId=1&createdIssueId=1"
  : "/data/issue";
---

<Layout>
  <BackButton slot="left" href={backHref} />
  <NotificationBanner
    slot="center"
    type="warning"
    title="Adding a new issue"
    icon="warning"
    >{
      isForOriginal
        ? `Create an issue for '${forkProject}' that describes your fork`
        : "You are adding a new issue"
    }</NotificationBanner
  >

  <IssueCard
    slot="center"
    panelTitle="Add a new Issue"
    actions={[
      {
        variant: "primary",
        children: "Next",
        uri: "/data/issue",
      },
    ]}
  />
  <VotingSection slot="center" />
  <IssueDetails slot="right" />
  <ChatPanel slot="right" client:load />
</Layout>

<style is:global>
  @import "@chatscope/chat-ui-kit-styles/dist/default/styles.min.css";
</style>
